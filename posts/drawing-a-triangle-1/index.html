<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Drawing a triangle using Vulkan (1)" /><meta property="og:locale" content="en" /><meta name="description" content="After writing or copying over 1000 lines of code, I finally rendered my first triangle using Vulkan. Seeing it on the screen was so exciting!" /><meta property="og:description" content="After writing or copying over 1000 lines of code, I finally rendered my first triangle using Vulkan. Seeing it on the screen was so exciting!" /><link rel="canonical" href="https://guojiechang.github.io//posts/drawing-a-triangle-1/" /><meta property="og:url" content="https://guojiechang.github.io//posts/drawing-a-triangle-1/" /><meta property="og:site_name" content="Jiechang Guo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-09-13T14:33:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Drawing a triangle using Vulkan (1)" /><meta name="twitter:site" content="@JiechangGuo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-09-13T14:33:00-05:00","datePublished":"2023-09-13T14:33:00-05:00","description":"After writing or copying over 1000 lines of code, I finally rendered my first triangle using Vulkan. Seeing it on the screen was so exciting!","headline":"Drawing a triangle using Vulkan (1)","mainEntityOfPage":{"@type":"WebPage","@id":"https://guojiechang.github.io//posts/drawing-a-triangle-1/"},"url":"https://guojiechang.github.io//posts/drawing-a-triangle-1/"}</script><title>Drawing a triangle using Vulkan (1) | Jiechang Guo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jiechang Guo"><meta name="application-name" content="Jiechang Guo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/images/IMG_4529.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jiechang Guo</a></div><div class="site-subtitle font-italic">Keeping recording every bit of my coding life</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/Resume/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/GuoJiechang" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jiechangguo','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/jiechangguo" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Drawing a triangle using Vulkan (1)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Drawing a triangle using Vulkan (1)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1694633580" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 13, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/JiechangGuo">Jiechang Guo</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1458 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>After writing or copying over 1000 lines of code, I finally rendered my first triangle using Vulkan. Seeing it on the screen was so exciting!</p><p><img data-src="/assets/images/Drawing%20a%20triangle%20(1)%20c64c827c09a14a3ea6f347bf9f04e258/Untitled.png" alt="Untitled" data-proofer-ignore></p><p>I want to learn Vulkan to study state-of-the-art techniques in the field of computer graphics. I find the process of learning new techniques enjoyable, which makes me feel refreshed and positive.</p><h2 id="application-outline"><span class="mr-2">Application outline</span><a href="#application-outline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The base code is simple. Basically four steps involved in an application:</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="n">HelloTriangleApplication</span><span class="o">::</span><span class="n">run</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">initWindow</span><span class="p">();</span>
    <span class="n">initVulkan</span><span class="p">();</span>
    <span class="n">mainLoop</span><span class="p">();</span>
    <span class="n">cleanUp</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="initwindow"><span class="mr-2">initWindow()</span><a href="#initwindow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One major difference between OpenGL and Vulkan is that, for OpenGL, a window is required to create a context. If one would like to do off-screen rendering, a hidden window will be the solution. In contrast, Vulkan can function perfectly well without a window.</p><p>We still need to know how to show the rendered object in a window. We use GLFW library to create a window to display the rendered image on the screen.</p><h3 id="initvulkan"><span class="mr-2">initVulkan()</span><a href="#initvulkan" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Initializing Vulkan is the most verbose part of the code. Every detail related to the graphics API needs to be set up explicitly from scratch in the application. As you can see in the following code, it takes 13 steps to initialize Vulkan. We will go into detail on each part and try to understand them.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="n">HelloTriangleApplication</span><span class="o">::</span><span class="n">initVulkan</span><span class="p">(){</span>
    <span class="n">createInstance</span><span class="p">();</span>
    <span class="n">setupDebugMessenger</span><span class="p">();</span>
    <span class="n">createSurface</span><span class="p">();</span>
    <span class="n">pickPhysicalDevice</span><span class="p">();</span>
    <span class="n">createLogicalDevice</span><span class="p">();</span>
    <span class="n">createSwapChain</span><span class="p">();</span>
    <span class="n">createImageViews</span><span class="p">();</span>
    <span class="n">createRenderPass</span><span class="p">();</span>
    <span class="n">createGraphicsPipeline</span><span class="p">();</span>
    <span class="n">createFramebuffers</span><span class="p">();</span>
    <span class="n">createCommandPool</span><span class="p">();</span>
    <span class="n">createCommandBuffer</span><span class="p">();</span>
    <span class="n">createSyncObjects</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="mainloop"><span class="mr-2">mainLoop()</span><a href="#mainloop" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In the main loop, we will draw a frame until the window is closed or we encountered an error.</p><p>Everything in the drawFrame() are asynchronous, when we exit the loop, the operations may still be going on, thus, we need to wait for the device to finish all the operations before exiting mainLoop() and enter cleanUp().</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="n">HelloTriangleApplication</span><span class="o">::</span><span class="n">mainLoop</span><span class="p">(){</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">glfwPollEvents</span><span class="p">();</span>
        <span class="n">drawFrame</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="n">vkDeviceWaitIdle</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="cleanup"><span class="mr-2">cleanUp()</span><a href="#cleanup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Once the window is closed, everything we created need to be destroy explicitly.</p><h2 id="vulkan-initialization"><span class="mr-2">Vulkan Initialization</span><a href="#vulkan-initialization" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="createinstance"><span class="mr-2">createInstance()</span><a href="#createinstance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>VkInstance instance is needed for every Vulkan application which is the connection between the application and the Vulkan library. VkInstance is the first Vulkan object we created.</p><p>The general pattern to create a Vulkan object is:</p><ul><li>Pointer to struct with creation info, a struct related to the object we want to create<li>Pointer to custom allocator callbacks, for now, idk what it is<li>Pointer to the variable that stores the handle to the new object<li>The function will return VkResult to tell if we create the object successfully</ul><p>Vulkan object created by us needs to be explicitly destroyed. vkCreateXXX + vkDestroyXXX, vkAllocateXXX + vkFreeXXX</p><p>The VkInstanceCreateInfo createInfo contains the information about the application, global extension, and enabled layers like the validation layer for debugging purpose. Call vkCreateInstance to create the Vulkan instance.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">VkResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">vkCreateInstance</span><span class="p">(</span><span class="o">&amp;</span><span class="n">createInfo</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">instance</span><span class="p">);</span>
</pre></table></code></div></div><p>The correspondence destroy function is vkDestroyInstance(instance,nullptr).</p><p>Now let’s go into detail on the vkInstanceCreateInfo. Typically, Vulkan struct will need us to explicitly set the VkStructureType. The information about the application including the name of the application, version information, etc. The enabled layers information contains the layers we want to enable. Vulkan introduces validation layers system to help us debug our program. The enabled extension information contains the extensions we enabled in the program.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">VkInstanceCreateInfo</span> <span class="p">{</span>
    <span class="n">VkStructureType</span>             <span class="n">sType</span><span class="p">;</span> <span class="c1">//the type of the struct need to be specified</span>
    <span class="k">const</span> <span class="kt">void</span><span class="o">*</span>                 <span class="n">pNext</span><span class="p">;</span> <span class="c1">//optional</span>
    <span class="n">VkInstanceCreateFlags</span>       <span class="n">flags</span><span class="p">;</span>

		<span class="c1">//application information</span>
    <span class="k">const</span> <span class="n">VkApplicationInfo</span><span class="o">*</span>    <span class="n">pApplicationInfo</span><span class="p">;</span>
		<span class="c1">//enable layers information</span>
    <span class="kt">uint32_t</span>                    <span class="n">enabledLayerCount</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>          <span class="n">ppEnabledLayerNames</span><span class="p">;</span>
		<span class="c1">//enable extension information</span>
    <span class="kt">uint32_t</span>                    <span class="n">enabledExtensionCount</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="o">*</span>          <span class="n">ppEnabledExtensionNames</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VkInstanceCreateInfo</span><span class="p">;</span>
</pre></table></code></div></div><p><strong>Extensions</strong></p><ol><li><p>glfwExtensions</p><p>Vulkan is a platform agnostic API, extensions are required to interface with the window system. GLFW provide built-in function that returns the required extensions.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="n">glfwExtensions</span> <span class="o">=</span> <span class="n">glfwGetRequiredInstanceExtensions</span><span class="p">(</span><span class="o">&amp;</span><span class="n">glfwExtensionCount</span><span class="p">);</span>
</pre></table></code></div></div><li><p>debug extensions</p><p>To setup a debug messenger with a callback we need to enable the extension: VK_EXT_DEBUG_UTILS_EXTENSION_NAME</p><li><p>solve MacOS issue VK_ERROR_INCOMPATIBLE_DRIVER</p></ol><p>VK_KHR_PORTABILITY_subset extension is mandatory</p><p>(1) VK_KHR_PORTABILITY_ENUMERATION_EXTENSION_NAME</p><p>Also, a flag VK_INSTANCE_CREATE_ENUMERATE_PORTABILITY_BIT_KHR should be added to createInfo</p><p>(2) “VK_KHR_get_physical_device_properties2”</p><p>Note that the first extension is a macro definition, the second is a string</p><p><strong>Validation</strong> <strong>Layers</strong></p><p>We enabled “VK_LAYER_KHRONOS_validation” layer if in Debug mode.</p><p>We also need to check if the system support validation layer.</p><p>The general pattern to get properties from Vulkan is list in the following code. We will call the vkEnumerateXXXProperties for two times. The first time is to get the number of the properties, then we can initialize the container for handling the exact data.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kt">uint32_t</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">//the first parameter</span>
<span class="n">vkEnumerateXXXProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span><span class="nb">nullptr</span><span class="p">);</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">VkXXXProperties</span><span class="o">&gt;</span> <span class="n">properties</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>
<span class="n">vkEnumerateXXXProperties</span><span class="p">(</span><span class="o">&amp;</span><span class="n">count</span><span class="p">,</span><span class="n">properties</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></table></code></div></div><p>For checking the validation layer VkLayerProperties support, the function is vkEnumerateInstanceLayerProperties.</p><h3 id="createsurface"><span class="mr-2">createSurface()</span><a href="#createsurface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>After creating the instance, we need to create a VkSurfaceKHR object to present rendered images to the screen. Here we use the built-in function of GLFW to create window surface.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">glfwCreateWindowSurface</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">surface</span><span class="p">)</span>
</pre></table></code></div></div><h3 id="pickphysicaldevice"><span class="mr-2">pickPhysicalDevice()</span><a href="#pickphysicaldevice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To select a suitable physical device which is a graphics card in the system. We are able to select any number of graphics cards and use them simultaneously. For beginner, we only use the first graphic card ): looks like I have choice, developing on MacOS.</p><p>To get available physical devices VkPhysicalDevice, is similar to get properties except we need the instance. The function is</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">vkEnumeratePhysicalDevices</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceCount</span><span class="p">,</span> <span class="n">devices</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></table></code></div></div><p>From the available physical devices, we will choose the one suitable for our application.</p><p><strong>isDeviceSuitable(device)</strong></p><p>The suitable device will satisfy the following three requirements: queue families, extensions, swap chain</p><ol><li>findQueueFamilies(device)</ol><p>Most operations performed with Vulkan from draw commands to uploading textures requires commands to be submitted to a queue. Different types of queues are from different queue families which support different subset of commands. We need to find out the queue families that are supported by the device as well as meet our requirements. In this simply triangle application, we need the indices of two queue families includes graphics family that supports graphics commands and present family that supports presenting the rendered image to the surface. To get the supported queue families VkQueueFamilyProperties is similar to get properties as mentioned before.</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">vkGetPhysicalDeviceQueueFamilyProperties</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">queueFamilyCount</span><span class="p">,</span> <span class="n">queueFamilies</span><span class="p">.</span><span class="n">data</span><span class="p">())</span>
</pre></table></code></div></div><p>Then we iterate over the queue families we get and find out the index of queue we needed.</p><ol><li>checkDeviceExtensionSupport(device)</ol><p>We first get all the available extensions, then iterate over the extensions to check if the required extensions exist. Currently, the required device extension is VK_KHR_SWAPCHAIN_EXTENSION_NAME</p><div class="language-cpp highlighter-rouge"><div class="code-header"> <span data-label-text="Cpp"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">vkEnumerateDeviceExtensionProperties</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">extensionCount</span><span class="p">,</span> <span class="n">availableExtensions</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
</pre></table></code></div></div><ol><li>check swap chain support</ol><p>Swap chain is like a “default framebuffer” to store the images waiting to be presented to the screen. If swap chain extension in 2 is supported, we need to query the detail of the swap chain. And check if it meet our requirement. In this simple program, we will consider the swap chain adequate if it supports at least one surface format(pixel format, color space) and one presentation mode.</p><p>If we find the queue families indices and all the extensions supported, we will choose this device as our physical device.</p><h3 id="createlogicaldevice"><span class="mr-2">createLogicalDevice()</span><a href="#createlogicaldevice" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A logical device is needed to set up to interface with the physical device we just created where we can describe more specifically how we will use the physical device.</p><p>We need to specifying the queues to be created, the device features to be used, the extensions to be enabled, and the validation layer to be enabled.</p><p>To solve the issue with VK_ERROR_INCOMPATIBLE_DRIVER on MacOS, we need to enable “VK_KHR_portability_subset” extension.</p><p>The we based on the above information included in VkDeviceCreateInfo struct, we create the logical device.</p><p>The last step is to retrieve the queue handle we created.</p><h3 id="createswapchain"><span class="mr-2">createSwapChain()</span><a href="#createswapchain" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>When picking physical device, we already enable the swap chain support and query its detail, now it’s time for us to actually create swap chain.</p><p>We will choose the properties of the swap chain including: surface format(pixel format, color space), presentation mode, swap extent, image count in a swap chain.</p><p>After we choose the ideal value of the properties, we will create the swap chain object.</p><p>I’ll keep the detail of the properties selection for now. It is better for me to get the bigger picture first.</p><h3 id="createimageviews"><span class="mr-2">createImageViews()</span><a href="#createimageviews" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A VkImageView describes how to view an image. We will create VkImageView that match the image in the swap chain. That is to say we will create a VkImageView object for every image in the swap chain. In this simple demo, we simply treat the images as 2D textures.</p><h3 id="createrenderpass"><span class="mr-2">createRenderPass()</span><a href="#createrenderpass" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Render pass object wrap the information for the framebuffer attachments. Including the number of color and depth buffers that will be used while rendering, number of samples for each buffer, etc. For this demo, a single color buffer attachment and a subpass were created for the render pass object.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cg-notes/'>CG_Notes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cg/" class="post-tag no-text-decoration" >CG</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Drawing+a+triangle+using+Vulkan+%281%29+-+Jiechang+Guo&url=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Fdrawing-a-triangle-1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Drawing+a+triangle+using+Vulkan+%281%29+-+Jiechang+Guo&u=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Fdrawing-a-triangle-1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Fdrawing-a-triangle-1%2F&text=Drawing+a+triangle+using+Vulkan+%281%29+-+Jiechang+Guo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/android-studio-giraffe-kotlin-opencv-4-8-0/">Android Studio Giraffe + Kotlin + OpenCV 4.8.0</a><li><a href="/posts/study-notes-of-smplify/">Study Notes of Smplify</a><li><a href="/posts/image-classification-with-cnn-and-transfer-learning/">Image classification with CNN and Transfer Learning</a><li><a href="/posts/smpl-python2-7-with-ubuntu22-04-1-and-anaconda/">SMPL python2.7 with Ubuntu22.04.1 and Anaconda</a><li><a href="/posts/leetcode-0004-median-of-two-sorted-arrays/">Leetcode 0004 Median of Two Sorted Arrays</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/cg/">CG</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/hello-world-of-three-js/"><div class="card-body"> <em class="small" data-ts="1701899280" data-df="ll" > Dec 6, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hello World of Three.js</h3><div class="text-muted small"><p> This is the demo I created when learning Three.js. {% include threejshelloworld1.html %} three.js with jekyll post I finally figured out how to embed HTML with three.js in a markdown file. The HTM...</p></div></div></a></div><div class="card"> <a href="/posts/learn-webgl-demo/"><div class="card-body"> <em class="small" data-ts="1697038260" data-df="ll" > Oct 11, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learn WebGL Demo</h3><div class="text-muted small"><p> This is the demo I created when learning WebGL. {% include webgldemo.html %}</p></div></div></a></div><div class="card"> <a href="/posts/android-studio-giraffe-kotlin-opencv-4-8-0/"><div class="card-body"> <em class="small" data-ts="1694110920" data-df="ll" > Sep 7, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Studio Giraffe + Kotlin + OpenCV 4.8.0</h3><div class="text-muted small"><p> After hours of attempting, I finally integrated OpenCV 4.8.0 to Android Studio Giraffe with the Kotlin project. I’ll skip the steps for downloading AS and OpenCV. Just remember to download the And...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/android-studio-giraffe-kotlin-opencv-4-8-0/" class="btn btn-outline-primary" prompt="Older"><p>Android Studio Giraffe + Kotlin + OpenCV 4.8.0</p></a> <a href="/posts/learn-webgl-demo/" class="btn btn-outline-primary" prompt="Newer"><p>Learn WebGL Demo</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/JiechangGuo">Jiechang Guo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/cg/">CG</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-03TQ7PBP8Y"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-03TQ7PBP8Y'); }); </script>
