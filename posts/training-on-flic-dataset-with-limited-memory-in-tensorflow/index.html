<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Training on FLIC Dataset with Limited Memory in Tensorflow" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction I attempted to run the code from the joint_cnn_mrf, which is the first and only implementation of the paper “Joint Training of a Convolutional Network and a Graphical Model for Human Pose Estimation.” However, I encountered several challenges due to the version difference between Tensorflow 1.x and Tensorflow 2.x, as well as memory limitations. The code requires loading the entire training and testing datasets into memory, which proved to be a challenge for my computer with only 32GB of RAM. I even tried to migrate it to Colab and upgraded to Colab Pro, but the data processing consumed more than 50GB of memory and used up the compute unit immediately. It seems the authors must have had a powerful computer even in 2018. As recommended by the authors, I have decided to implement the code from scratch." /><meta property="og:description" content="Introduction I attempted to run the code from the joint_cnn_mrf, which is the first and only implementation of the paper “Joint Training of a Convolutional Network and a Graphical Model for Human Pose Estimation.” However, I encountered several challenges due to the version difference between Tensorflow 1.x and Tensorflow 2.x, as well as memory limitations. The code requires loading the entire training and testing datasets into memory, which proved to be a challenge for my computer with only 32GB of RAM. I even tried to migrate it to Colab and upgraded to Colab Pro, but the data processing consumed more than 50GB of memory and used up the compute unit immediately. It seems the authors must have had a powerful computer even in 2018. As recommended by the authors, I have decided to implement the code from scratch." /><link rel="canonical" href="https://guojiechang.github.io//posts/training-on-flic-dataset-with-limited-memory-in-tensorflow/" /><meta property="og:url" content="https://guojiechang.github.io//posts/training-on-flic-dataset-with-limited-memory-in-tensorflow/" /><meta property="og:site_name" content="Jiechang Guo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-28T10:38:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Training on FLIC Dataset with Limited Memory in Tensorflow" /><meta name="twitter:site" content="@JiechangGuo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-28T10:38:00-05:00","datePublished":"2023-03-28T10:38:00-05:00","description":"Introduction I attempted to run the code from the joint_cnn_mrf, which is the first and only implementation of the paper “Joint Training of a Convolutional Network and a Graphical Model for Human Pose Estimation.” However, I encountered several challenges due to the version difference between Tensorflow 1.x and Tensorflow 2.x, as well as memory limitations. The code requires loading the entire training and testing datasets into memory, which proved to be a challenge for my computer with only 32GB of RAM. I even tried to migrate it to Colab and upgraded to Colab Pro, but the data processing consumed more than 50GB of memory and used up the compute unit immediately. It seems the authors must have had a powerful computer even in 2018. As recommended by the authors, I have decided to implement the code from scratch.","headline":"Training on FLIC Dataset with Limited Memory in Tensorflow","mainEntityOfPage":{"@type":"WebPage","@id":"https://guojiechang.github.io//posts/training-on-flic-dataset-with-limited-memory-in-tensorflow/"},"url":"https://guojiechang.github.io//posts/training-on-flic-dataset-with-limited-memory-in-tensorflow/"}</script><title>Training on FLIC Dataset with Limited Memory in Tensorflow | Jiechang Guo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Jiechang Guo"><meta name="application-name" content="Jiechang Guo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/images/IMG_4529.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jiechang Guo</a></div><div class="site-subtitle font-italic">Keeping recording every bit of my coding life</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/Resume/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>RESUME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/GuoJiechang" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['jiechangguo','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/jiechangguo" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Training on FLIC Dataset with Limited Memory in Tensorflow</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Training on FLIC Dataset with Limited Memory in Tensorflow</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1680017880" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 28, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/JiechangGuo">Jiechang Guo</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="987 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h1 id="introduction">Introduction</h1><p>I attempted to run the code from the <a href="https://github.com/max-andr/joint-cnn-mrf">joint_cnn_mrf</a>, which is the first and only implementation of the paper “Joint Training of a Convolutional Network and a Graphical Model for Human Pose Estimation.” However, I encountered several challenges due to the version difference between Tensorflow 1.x and Tensorflow 2.x, as well as memory limitations. The code requires loading the entire training and testing datasets into memory, which proved to be a challenge for my computer with only 32GB of RAM. I even tried to migrate it to Colab and upgraded to Colab Pro, but the data processing consumed more than 50GB of memory and used up the compute unit immediately. It seems the authors must have had a powerful computer even in 2018. As recommended by the authors, I have decided to implement the code from scratch.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="n">tfds</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>
<span class="kn">import</span> <span class="nn">imageio</span>
</pre></table></code></div></div><h1 id="download-data">Download Data</h1><p>To download file from google drive, share the file by link and set the access permission to everyone who knows the link. For example, my shared link is https://drive.google.com/file/d/16o7zXFl2PsFHXf9OVEc7OVJrQZ6ru1Mv/view?usp=share_link, copy the magic string ‘16o7zXFl2PsFHXf9OVEc7OVJrQZ6ru1Mv’</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">!</span><span class="n">gdown</span> <span class="mi">16</span><span class="n">o7zXFl2PsFHXf9OVEc7OVJrQZ6ru1Mv</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Downloading...
From: https://drive.google.com/uc?id=16o7zXFl2PsFHXf9OVEc7OVJrQZ6ru1Mv
To: /content/FLIC.zip
100% 300M/300M [00:02&lt;00:00, 138MB/s]
</pre></table></code></div></div><p>Unzip the file</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="err">!</span><span class="n">unzip</span> <span class="s">'/content/FLIC.zip'</span>
</pre></table></code></div></div><h1 id="generate-ground-truth-heatmaps">Generate Ground Truth Heatmaps</h1><p>The code is adapted from https://github.com/max-andr/joint-cnn-mrf</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">#load the annotation data from the annotation file path
</span><span class="n">data_FLIC</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s">'/content/FLIC/examples.mat'</span><span class="p">)</span>
<span class="n">data_FLIC</span> <span class="o">=</span> <span class="n">data_FLIC</span><span class="p">[</span><span class="s">'examples'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#path to the image file
</span><span class="n">images_dir</span> <span class="o">=</span> <span class="s">'/content/FLIC/images/'</span>

</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">#define joint ids
</span><span class="n">joint_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s">'lsho'</span><span class="p">,</span> <span class="s">'lelb'</span><span class="p">,</span> <span class="s">'lwri'</span><span class="p">,</span> <span class="s">'rsho'</span><span class="p">,</span> <span class="s">'relb'</span><span class="p">,</span> <span class="s">'rwri'</span><span class="p">,</span> <span class="s">'lhip'</span><span class="p">,</span> <span class="s">'rhip'</span><span class="p">,</span> <span class="s">'nose'</span><span class="p">]</span>  <span class="c1"># , 'leye', 'reye',
</span><span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">'lsho'</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s">'lelb'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'lwri'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'rsho'</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">'relb'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">'rwri'</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s">'lhip'</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
            <span class="s">'lkne'</span><span class="p">:</span>   <span class="mi">7</span><span class="p">,</span> <span class="s">'lank'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s">'rhip'</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s">'rkne'</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">'rank'</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s">'leye'</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s">'reye'</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
            <span class="s">'lear'</span><span class="p">:</span>   <span class="mi">14</span><span class="p">,</span> <span class="s">'rear'</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s">'nose'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s">'msho'</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s">'mhip'</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s">'mear'</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s">'mtorso'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
            <span class="s">'mluarm'</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="s">'mruarm'</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s">'mllarm'</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="s">'mrlarm'</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="s">'mluleg'</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s">'mruleg'</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span>
            <span class="s">'mllleg'</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span> <span class="s">'torso'</span><span class="p">:</span> <span class="mi">28</span><span class="p">}</span>

<span class="c1">#get train and test data index
</span><span class="n">is_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_FLIC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">7</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_FLIC</span><span class="p">))]</span>
<span class="n">is_train</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">is_train</span><span class="p">)</span>
<span class="n">train_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_train</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">test_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(</span><span class="n">is_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="s">'# train indices:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_index</span><span class="p">),</span> <span class="s">'  # test indices:'</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre># train indices: 3987   # test indices: 1016
</pre></table></code></div></div><p>Define the Gaussian Kernel for generating the heatmaps.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">orig_h</span><span class="p">,</span> <span class="n">orig_w</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">720</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>  <span class="c1"># maximizes performance
</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">coefs</span><span class="p">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">coefs</span>
<span class="n">temp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">pad</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># use padding to avoid the exceeding of the boundary
</span></pre></table></code></div></div><p>Create a list to store train filenames and also a list to store test filenames. In the meantime, generate groud-truth heatmap for train and test dataset.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="n">train_filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_filenames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">train_heatmaps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_heatmaps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">hmaps</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">train_filenames</span><span class="p">,</span><span class="n">test_filenames</span><span class="p">],</span> <span class="p">[</span><span class="n">train_heatmaps</span><span class="p">,</span><span class="n">test_heatmaps</span><span class="p">],[</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">]):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
    <span class="n">filenames</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_FLIC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">flic_coords</span> <span class="o">=</span> <span class="n">data_FLIC</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">heatmaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">torso</span> <span class="o">=</span> <span class="p">(</span><span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="s">'lsho'</span><span class="p">]]</span> <span class="o">+</span> <span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="s">'rhip'</span><span class="p">]]</span> <span class="o">+</span> <span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="s">'rsho'</span><span class="p">]]</span> <span class="o">+</span>
                     <span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="s">'lhip'</span><span class="p">]])</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="s">'torso'</span><span class="p">]]</span> <span class="o">=</span> <span class="n">torso</span>
    <span class="k">for</span> <span class="n">joint</span> <span class="ow">in</span> <span class="n">joint_ids</span> <span class="o">+</span> <span class="p">[</span><span class="s">'torso'</span><span class="p">]:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">flic_coords</span><span class="p">[:,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">joint</span><span class="p">]])</span>
        <span class="c1"># there are some annotation that are outside of the image (annotators did a great job!)
</span>        <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">orig_h</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">orig_w</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">/=</span> <span class="mi">8</span>
        <span class="n">heat_map</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">heat_map</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">lib</span><span class="p">.</span><span class="n">pad</span><span class="p">(</span><span class="n">heat_map</span><span class="p">,</span> <span class="p">((</span><span class="n">pad</span><span class="p">,</span> <span class="n">pad</span><span class="p">),</span> <span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">pad</span><span class="p">)),</span> <span class="s">'constant'</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">+</span> <span class="n">pad</span>
        <span class="n">h1_k</span><span class="p">,</span> <span class="n">h2_k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">w1_k</span><span class="p">,</span> <span class="n">w2_k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">temp</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">temp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">heat_map</span><span class="p">[</span><span class="n">h1_k</span><span class="p">:</span><span class="n">h2_k</span><span class="p">,</span> <span class="n">w1_k</span><span class="p">:</span><span class="n">w2_k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kernel</span>
        <span class="n">heat_map</span> <span class="o">=</span> <span class="n">heat_map</span><span class="p">[</span><span class="n">pad</span><span class="p">:</span><span class="n">pad</span> <span class="o">+</span> <span class="mi">60</span><span class="p">,</span> <span class="n">pad</span><span class="p">:</span><span class="n">pad</span> <span class="o">+</span> <span class="mi">90</span><span class="p">]</span>
        <span class="n">heatmaps</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">heat_map</span><span class="p">)</span>
        <span class="n">hmap</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">heatmaps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">hmaps</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">hmap</span><span class="p">)</span>
</pre></table></code></div></div><p>Check the length and shape of the data created.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_filenames</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_filenames</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_heatmaps</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">train_heatmaps</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_heatmaps</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">test_heatmaps</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">shape</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>3987
1016
3987
(60, 90, 10)
1016
(60, 90, 10)
</pre></table></code></div></div><p>We can save the numpy file for latter usage. We don’t have to do the data process every time.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">np</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'x_train_filenames.npy'</span><span class="p">,</span><span class="n">train_filenames</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'x_test_filenames.npy'</span><span class="p">,</span><span class="n">test_filenames</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'y_train.npy'</span><span class="p">,</span><span class="n">train_heatmaps</span><span class="p">)</span>
<span class="n">np</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'y_test.npy'</span><span class="p">,</span><span class="n">test_heatmaps</span><span class="p">)</span>
</pre></table></code></div></div><h1 id="create-custom-data-generator-for-training-in-tensorflow">Create Custom Data Generator for Training in Tensorflow</h1><p>Create a custom batch data generator, each time the generator will help us to load the images from the disk.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Flic_Generator</span><span class="p">(</span><span class="n">keras</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">Sequence</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_filenames</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span> <span class="p">:</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">image_filenames</span> <span class="o">=</span> <span class="n">image_filenames</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>

  <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">image_filenames</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span><span class="p">))).</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">int</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="p">:</span>
    <span class="n">batch_x</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">image_filenames</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span><span class="p">]</span>
    <span class="n">batch_y</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span> <span class="p">:</span> <span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">batch_size</span><span class="p">]</span>

    <span class="c1">#load the images and normalized it, in our case, the model takes the original size of the image as input
</span>    <span class="c1">#no need to resize
</span>    <span class="n">x_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">imageio</span><span class="p">.</span><span class="n">v2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'/content/FLIC/images/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span> <span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">batch_x</span><span class="p">])</span><span class="o">/</span><span class="mi">255</span>
    <span class="n">y_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">batch_y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_array</span><span class="p">,</span><span class="n">y_array</span>
</pre></table></code></div></div><p>Create train and test data generator</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>

<span class="n">training_batch_generator</span> <span class="o">=</span> <span class="n">Flic_Generator</span><span class="p">(</span><span class="n">train_filenames</span><span class="p">,</span><span class="n">train_heatmaps</span><span class="p">,</span><span class="n">batch_size</span><span class="p">)</span>
<span class="n">test_batch_generator</span> <span class="o">=</span> <span class="n">Flic_Generator</span><span class="p">(</span><span class="n">test_filenames</span><span class="p">,</span><span class="n">test_heatmaps</span><span class="p">,</span><span class="n">batch_size</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="n">training_batch_generator</span><span class="p">.</span><span class="n">image_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>12-oclock-high-special-edition-00006361.jpg
</pre></table></code></div></div><p>Show one image</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">img</span> <span class="o">=</span> <span class="n">imageio</span><span class="p">.</span><span class="n">v2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="s">'/content/FLIC/images/'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">training_batch_generator</span><span class="p">.</span><span class="n">image_filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/images/FLIC_Load_to_memory/output_26_0.png" alt="png" data-proofer-ignore></p><p>Show the heatmaps</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">heatmaps</span> <span class="o">=</span> <span class="n">training_batch_generator</span><span class="p">.</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">heatmaps</span><span class="p">.</span><span class="n">shape</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(60, 90, 10)
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">#transpose the heatmaps array
</span><span class="n">heatmaps</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">heatmaps</span><span class="p">,(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">heatmaps</span><span class="p">.</span><span class="n">shape</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>(10, 60, 90)
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">combined_heatmap</span> <span class="o">=</span> <span class="n">heatmaps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
  <span class="n">combined_heatmap</span> <span class="o">+=</span> <span class="n">heatmaps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">combined_heatmap</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/images/FLIC_Load_to_memory/output_30_0.png" alt="png" data-proofer-ignore></p><h1 id="train-and-test-the-model">Train and Test the model</h1><p>We will use fit_generator to train the model, and predict_generator to test the test dataset. Tensorflow will call the “<strong>getitem</strong>” in the background for each iteration.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">fit_generator</span><span class="p">(</span><span class="n">generator</span><span class="o">=</span><span class="n">training_batch_generator</span><span class="p">,</span><span class="n">epochs</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">predicted</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict_generator</span><span class="p">(</span><span class="n">test_batch_generator</span><span class="p">)</span>

</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/cv-notes/'>CV_Notes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cv/" class="post-tag no-text-decoration" >CV</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Training+on+FLIC+Dataset+with+Limited+Memory+in+Tensorflow+-+Jiechang+Guo&url=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Ftraining-on-flic-dataset-with-limited-memory-in-tensorflow%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Training+on+FLIC+Dataset+with+Limited+Memory+in+Tensorflow+-+Jiechang+Guo&u=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Ftraining-on-flic-dataset-with-limited-memory-in-tensorflow%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fguojiechang.github.io%2F%2Fposts%2Ftraining-on-flic-dataset-with-limited-memory-in-tensorflow%2F&text=Training+on+FLIC+Dataset+with+Limited+Memory+in+Tensorflow+-+Jiechang+Guo" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/android-studio-giraffe-kotlin-opencv-4-8-0/">Android Studio Giraffe + Kotlin + OpenCV 4.8.0</a><li><a href="/posts/study-notes-of-smplify/">Study Notes of Smplify</a><li><a href="/posts/image-classification-with-cnn-and-transfer-learning/">Image classification with CNN and Transfer Learning</a><li><a href="/posts/smpl-python2-7-with-ubuntu22-04-1-and-anaconda/">SMPL python2.7 with Ubuntu22.04.1 and Anaconda</a><li><a href="/posts/leetcode-0004-median-of-two-sorted-arrays/">Leetcode 0004 Median of Two Sorted Arrays</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/cg/">CG</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/image-classification-with-cnn-and-transfer-learning/"><div class="card-body"> <em class="small" data-ts="1675190280" data-df="ll" > Jan 31, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Image classification with CNN and Transfer Learning</h3><div class="text-muted small"><p> COSC 6373: Computer Vision In-Class Assignment 2 Image classification with Convolutional Neural Networks and Transfer Learning This note is an assignment from COSC 6373 assignment. Goal Using t...</p></div></div></a></div><div class="card"> <a href="/posts/cv-study-notes-classification-i/"><div class="card-body"> <em class="small" data-ts="1676938080" data-df="ll" > Feb 20, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CV Study Notes - Classification I</h3><div class="text-muted small"><p> Classification The definition of classification is: categorizing a given set of data into classes Example of classification(CAP5415 - Lecture 11 by L. Lazebnik) This post will focus on th...</p></div></div></a></div><div class="card"> <a href="/posts/hello-world-of-three-js/"><div class="card-body"> <em class="small" data-ts="1701899280" data-df="ll" > Dec 6, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hello World of Three.js</h3><div class="text-muted small"><p> This is the demo I created when learning Three.js. {% include threejshelloworld1.html %} three.js with jekyll post I finally figured out how to embed HTML with three.js in a markdown file. The HTM...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cv-study-notes-classification-i/" class="btn btn-outline-primary" prompt="Older"><p>CV Study Notes - Classification I</p></a> <a href="/posts/android-studio-giraffe-kotlin-opencv-4-8-0/" class="btn btn-outline-primary" prompt="Newer"><p>Android Studio Giraffe + Kotlin + OpenCV 4.8.0</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/JiechangGuo">Jiechang Guo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cv/">CV</a> <a class="post-tag" href="/tags/cg/">CG</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-03TQ7PBP8Y"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-03TQ7PBP8Y'); }); </script>
